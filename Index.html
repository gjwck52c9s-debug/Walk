<!doctype html>  
<html lang="en">  
<head>  
  <meta charset="utf-8" />  
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />  
  <meta name="theme-color" content="#0b1b2b" />  
  <title>WalkCut</title>  
  <style>  
    :root{  
      --bg:#0b1118;  
      --panel:#0f1a26;  
      --panel2:#0b1b2b;  
      --text:#e9eef6;  
      --muted:#a8b4c7;  
      --ok:#2dd4bf;  
      --warn:#f59e0b;  
      --bad:#fb7185;  
      --line:rgba(255,255,255,.12);  
      --shadow:0 16px 40px rgba(0,0,0,.45);  
      --radius:18px;  
      --radius2:14px;  
    }  
    *{box-sizing:border-box}  
    html,body{height:100%}  
    body{  
      margin:0;  
      background:radial-gradient(1200px 600px at 50% -10%, rgba(45,212,191,.12), transparent 60%),  
                 radial-gradient(900px 500px at 10% 10%, rgba(59,130,246,.10), transparent 55%),  
                 linear-gradient(180deg, #070b10, var(--bg));  
      color:var(--text);  
      font-family:-apple-system,BlinkMacSystemFont,system-ui,Segoe UI,Roboto,Helvetica,Arial;  
      -webkit-text-size-adjust:100%;  
      padding:env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);  
    }  
    a{color:inherit}  
    .wrap{  
      max-width:980px;  
      margin:0 auto;  
      padding:16px 14px 28px;  
    }  
    header{  
      display:flex;  
      align-items:center;  
      justify-content:space-between;  
      gap:12px;  
      margin-bottom:14px;  
    }  
    .brand{display:flex; align-items:center; gap:12px}  
    .logo{  
      width:44px;height:44px;border-radius:14px;  
      background:linear-gradient(135deg, rgba(45,212,191,.25), rgba(59,130,246,.16));  
      border:1px solid rgba(255,255,255,.16);  
      box-shadow:0 10px 30px rgba(0,0,0,.35);  
      display:grid; place-items:center;  
      position:relative; overflow:hidden;  
    }  
    .logo:before{  
      content:"";  
      position:absolute; inset:-40% -60%;  
      background:repeating-linear-gradient(  
        45deg,  
        rgba(255,255,255,.08) 0px,  
        rgba(255,255,255,.08) 10px,  
        rgba(255,255,255,0) 10px,  
        rgba(255,255,255,0) 26px  
      );  
      transform:rotate(12deg);  
      opacity:.5;  
    }  
    .logo span{  
      position:relative;  
      font-weight:800;  
      letter-spacing:.5px;  
      font-size:16px;  
      color:#eaf6ff;  
      text-shadow:0 2px 10px rgba(0,0,0,.35);  
    }  
    h1{  
      font-size:18px;  
      line-height:1.2;  
      margin:0;  
      letter-spacing:.2px;  
    }  
    .sub{font-size:12px;color:var(--muted);margin-top:2px}  
    .top-actions{display:flex; gap:8px; flex-wrap:wrap; justify-content:flex-end}  
    button, .btn{  
      -webkit-tap-highlight-color:transparent;  
      appearance:none;  
      border:1px solid rgba(255,255,255,.18);  
      background:rgba(15,26,38,.65);  
      color:var(--text);  
      padding:10px 12px;  
      border-radius:14px;  
      font-weight:650;  
      font-size:13px;  
      box-shadow:0 10px 24px rgba(0,0,0,.28);  
    }  
    button:active{transform:translateY(1px)}  
    .btn-primary{  
      background:linear-gradient(135deg, rgba(45,212,191,.25), rgba(59,130,246,.18));  
      border:1px solid rgba(45,212,191,.35);  
    }  
    .btn-danger{  
      background:linear-gradient(135deg, rgba(251,113,133,.18), rgba(245,158,11,.10));  
      border:1px solid rgba(251,113,133,.30);  
    }  
    .grid{  
      display:grid;  
      grid-template-columns:1.15fr .85fr;  
      gap:12px;  
    }  
    @media (max-width:860px){  
      .grid{grid-template-columns:1fr; }  
      .top-actions{justify-content:flex-start}  
    }  
    .card{  
      background:linear-gradient(180deg, rgba(15,26,38,.76), rgba(15,26,38,.55));  
      border:1px solid rgba(255,255,255,.12);  
      border-radius:var(--radius);  
      padding:14px;  
      box-shadow:var(--shadow);  
      position:relative;  
      overflow:hidden;  
    }  
    .card:before{  
      content:"";  
      position:absolute;  
      inset:-60px;  
      background:radial-gradient(420px 220px at 20% 10%, rgba(45,212,191,.12), transparent 65%),  
                 radial-gradient(420px 240px at 90% 0%, rgba(59,130,246,.10), transparent 60%);  
      pointer-events:none;  
    }  
    .card > *{position:relative}  
    .section-title{  
      display:flex; align-items:center; justify-content:space-between; gap:10px;  
      margin-bottom:10px;  
    }  
    .section-title h2{margin:0;font-size:14px;letter-spacing:.3px}  
    .pill{  
      display:inline-flex; align-items:center; gap:6px;  
      border:1px solid rgba(255,255,255,.16);  
      background:rgba(11,27,43,.45);  
      padding:7px 10px;  
      border-radius:999px;  
      color:var(--muted);  
      font-size:12px;  
      font-weight:650;  
    }  
    .rows{display:grid; gap:10px}  
    .row{  
      display:grid;  
      grid-template-columns:1.15fr .85fr;  
      gap:10px;  
      align-items:center;  
    }  
    .row label{  
      font-size:12px;  
      color:var(--muted);  
      line-height:1.2;  
    }  
    .input{  
      display:flex;  
      align-items:center;  
      gap:8px;  
      padding:10px 12px;  
      border-radius:14px;  
      border:1px solid rgba(255,255,255,.14);  
      background:rgba(7,11,16,.55);  
    }  
    .input input, .input select{  
      width:100%;  
      background:transparent;  
      border:0;  
      outline:0;  
      color:var(--text);  
      font-size:14px;  
      font-weight:650;  
    }  
    .input small{color:var(--muted); font-weight:650}  
    .split{display:grid; grid-template-columns:1fr 1fr; gap:10px}  
    .kpis{display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-top:12px}  
    .kpi{  
      border-radius:var(--radius2);  
      border:1px solid rgba(255,255,255,.12);  
      background:rgba(7,11,16,.45);  
      padding:12px;  
    }  
    .kpi .label{font-size:12px;color:var(--muted);margin-bottom:6px}  
    .kpi .value{font-size:20px;font-weight:850;letter-spacing:.2px}  
    .kpi .hint{font-size:12px;color:var(--muted);margin-top:6px}  
    .bar{  
      height:12px;  
      border-radius:999px;  
      background:rgba(255,255,255,.10);  
      border:1px solid rgba(255,255,255,.12);  
      overflow:hidden;  
      margin-top:10px;  
    }  
    .bar > div{  
      height:100%;  
      width:0%;  
      background:linear-gradient(90deg, rgba(45,212,191,.95), rgba(59,130,246,.75));  
    }  
    .mini{font-size:12px;color:var(--muted);margin-top:8px;line-height:1.35}  
    table{width:100%; border-collapse:collapse}  
    th,td{padding:10px 8px; border-bottom:1px solid rgba(255,255,255,.10); text-align:left}  
    th{font-size:12px;color:var(--muted);font-weight:750}  
    td{font-size:13px}  
    .right{text-align:right}  
    .muted{color:var(--muted)}  
    .good{color:var(--ok)}  
    .bad{color:var(--bad)}  
    .warn{color:var(--warn)}  
    .footer{margin-top:12px; font-size:12px; color:var(--muted); line-height:1.45}  
    .toast{  
      position:fixed; left:50%; bottom:18px; transform:translateX(-50%);  
      background:rgba(15,26,38,.92); border:1px solid rgba(255,255,255,.16);  
      color:var(--text); padding:10px 12px; border-radius:999px;  
      box-shadow:0 16px 50px rgba(0,0,0,.55);  
      display:none;  
      z-index:9999;  
      font-size:13px; font-weight:650;  
      max-width:min(560px, calc(100% - 26px));  
      text-align:center;  
    }  
    .toast.show{display:block; animation:pop .18s ease-out}  
    @keyframes pop{from{transform:translateX(-50%) translateY(6px); opacity:.2} to{transform:translateX(-50%) translateY(0); opacity:1}}  
    .tiny{font-size:11px; color:var(--muted)}  
    .note{  
      padding:10px 12px;  
      border-radius:14px;  
      border:1px dashed rgba(255,255,255,.18);  
      background:rgba(11,27,43,.25);  
      color:var(--muted);  
      font-size:12px;  
      line-height:1.4;  
      margin-top:10px;  
    }  
    .chips{display:flex; flex-wrap:wrap; gap:8px; margin-top:10px}  
    .chip{  
      padding:8px 10px;  
      border-radius:999px;  
      border:1px solid rgba(255,255,255,.16);  
      background:rgba(7,11,16,.45);  
      font-size:12px;  
      font-weight:650;  
      color:var(--text);  
    }  
  </style>  
</head>  
<body>  
  <div class="wrap">  
    <header>  
      <div class="brand">  
        <div class="logo"><span>WC</span></div>  
        <div>  
          <h1>WalkCut</h1>  
          <div class="sub">Walking + calorie control to cut 30 lbs.</div>  
        </div>  
      </div>  
      <div class="top-actions">  
        <button class="btn-primary" id="btnSave">Save</button>  
        <button id="btnAddToday">Log Today</button>  
        <button id="btnExport">Export</button>  
        <button class="btn-danger" id="btnReset">Reset</button>  
      </div>  
    </header>  

    <div class="grid">  
      <section class="card">  
        <div class="section-title">  
          <h2>Targets</h2>  
          <span class="pill" id="todayPill">Today: —</span>  
        </div>  

        <div class="rows">  
          <div class="row">  
            <label>Age</label>  
            <div class="input"><input id="age" inputmode="numeric" placeholder="44" /></div>  
          </div>  
          <div class="row">  
            <label>Height</label>  
            <div class="input">  
              <input id="heightFt" inputmode="numeric" placeholder="6" style="max-width:70px" />  
              <small>ft</small>  
              <input id="heightIn" inputmode="numeric" placeholder="1" style="max-width:70px" />  
              <small>in</small>  
            </div>  
          </div>  
          <div class="row">  
            <label>Current weight</label>  
            <div class="input"><input id="weight" inputmode="decimal" placeholder="225" /><small>lb</small></div>  
          </div>  
          <div class="row">  
            <label>Goal loss</label>  
            <div class="input"><input id="goalLoss" inputmode="decimal" placeholder="30" /><small>lb</small></div>  
          </div>  
          <div class="row">  
            <label>Weeks to goal</label>  
            <div class="input"><input id="weeks" inputmode="numeric" placeholder="12" /></div>  
          </div>  

          <div class="split">  
            <div>  
              <label class="tiny">Activity assumption</label>  
              <div class="input">  
                <select id="activity">  
                  <option value="1.2">Sedentary (desk)</option>  
                  <option value="1.375">Lightly active</option>  
                  <option value="1.55" selected>Moderately active</option>  
                  <option value="1.725">Very active</option>  
                </select>  
              </div>  
            </div>  
            <div>  
              <label class="tiny">Sex (for BMR estimate)</label>  
              <div class="input">  
                <select id="sex">  
                  <option value="male" selected>Male</option>  
                  <option value="female">Female</option>  
                </select>  
              </div>  
            </div>  
          </div>  

          <div class="kpis">  
            <div class="kpi">  
              <div class="label">Estimated calories/day (maintenance)</div>  
              <div class="value" id="kpiMaintain">—</div>  
              <div class="hint">Based on Mifflin-St Jeor + activity</div>  
            </div>  
            <div class="kpi">  
              <div class="label">Calories/day to hit goal</div>  
              <div class="value" id="kpiTargetCals">—</div>  
              <div class="hint">Goal deficit spread across weeks</div>  
            </div>  
            <div class="kpi">  
              <div class="label">Walking minutes/day (estimate)</div>  
              <div class="value" id="kpiWalkMin">—</div>  
              <div class="hint">Assumes ~3 mph and ~0.04 kcal/lb/min</div>  
            </div>  
            <div class="kpi">  
              <div class="label">Steps/day (estimate)</div>  
              <div class="value" id="kpiSteps">—</div>  
              <div class="hint">Assumes ~2,000 steps per mile</div>  
            </div>  
          </div>  

          <div class="bar" aria-label="progress"><div id="progressBar"></div></div>  
          <div class="mini" id="progressText">Enter targets to calculate.</div>  

          <div class="note">  
            This tool gives a practical daily walking target from your goal deficit. Real results vary by pace, terrain, and diet accuracy.  
          </div>  
        </div>  
      </section>  

      <aside class="card">  
        <div class="section-title">  
          <h2>Today Log</h2>  
          <span class="pill" id="logPill">Not logged</span>  
        </div>  

        <div class="rows">  
          <div class="row">  
            <label>Walk minutes today</label>  
            <div class="input"><input id="todayWalkMin" inputmode="decimal" placeholder="0" /><small>min</small></div>  
          </div>  
          <div class="row">  
            <label>Calories eaten today</label>  
            <div class="input"><input id="todayCals" inputmode="decimal" placeholder="0" /><small>kcal</small></div>  
          </div>  

          <div class="split">  
            <div>  
              <label class="tiny">Protein (oz)</label>  
              <div class="input"><input id="pOz" inputmode="decimal" placeholder="0" /><small>oz</small></div>  
            </div>  
            <div>  
              <label class="tiny">Carbs (oz)</label>  
              <div class="input"><input id="cOz" inputmode="decimal" placeholder="0" /><small>oz</small></div>  
            </div>  
          </div>  
          <div class="split">  
            <div>  
              <label class="tiny">Fat (oz)</label>  
              <div class="input"><input id="fOz" inputmode="decimal" placeholder="0" /><small>oz</small></div>  
            </div>  
            <div>  
              <label class="tiny">Fiber (oz)</label>  
              <div class="input"><input id="fibOz" inputmode="decimal" placeholder="0" /><small>oz</small></div>  
            </div>  
          </div>  

          <div class="kpis">  
            <div class="kpi">  
              <div class="label">Macro calories (from oz)</div>  
              <div class="value" id="kpiMacroCals">—</div>  
              <div class="hint">Protein/carbs 4 kcal/g, fat 9 kcal/g</div>  
            </div>  
            <div class="kpi">  
              <div class="label">Estimated net deficit today</div>  
              <div class="value" id="kpiDeficit">—</div>  
              <div class="hint">Maintenance + walk burn - eaten</div>  
            </div>  
          </div>  

          <div class="chips" id="chips"></div>  

          <div class="footer">  
            Tip: Use the <b>Save</b> button after edits. <b>Log Today</b> stamps today’s entry into history.  
          </div>  
        </div>  
      </aside>  
    </div>  

    <section class="card" style="margin-top:12px">  
      <div class="section-title">  
        <h2>History</h2>  
        <span class="pill muted" id="historyPill">0 days</span>  
      </div>  
      <div style="overflow:auto; border-radius:14px; border:1px solid rgba(255,255,255,.10)">  
        <table id="historyTable">  
          <thead>  
            <tr>  
              <th>Date</th>  
              <th class="right">Walk (min)</th>  
              <th class="right">Eaten (kcal)</th>  
              <th class="right">Deficit (est)</th>  
              <th class="right">Protein (oz)</th>  
              <th class="right">Carbs (oz)</th>  
              <th class="right">Fat (oz)</th>  
            </tr>  
          </thead>  
          <tbody></tbody>  
        </table>  
      </div>  
      <div class="footer">  
        Export creates a CSV you can save to Files. Reset clears everything stored on this device.  
      </div>  
    </section>  
  </div>  

  <div class="toast" id="toast"></div>  

  <script>  
    const $ = (id)=>document.getElementById(id);  

    const state = {  
      profile: {  
        age: 44,  
        heightFt: 6,  
        heightIn: 1,  
        weight: 225,  
        goalLoss: 30,  
        weeks: 12,  
        activity: 1.55,  
        sex: "male"  
      },  
      today: {  
        date: "",  
        walkMin: 0,  
        eaten: 0,  
        pOz: 0,  
        cOz: 0,  
        fOz: 0,  
        fibOz: 0  
      },  
      history: [] // array of entries {date, walkMin, eaten, deficit, pOz, cOz, fOz}  
    };  

    const STORAGE_KEY = "walkcut_v1";  

    function toast(msg){  
      const t = $("toast");  
      t.textContent = msg;  
      t.classList.add("show");  
      clearTimeout(toast._timer);  
      toast._timer = setTimeout(()=>t.classList.remove("show"), 1800);  
    }  

    function clampNum(n, min, max){  
      if(Number.isNaN(n)) return min;  
      return Math.min(max, Math.max(min, n));  
    }  

    function lbsToKg(lb){ return lb * 0.45359237; }  
    function inchesToCm(inches){ return inches * 2.54; }  

    function getTodayISO(){  
      const d = new Date();  
      const y = d.getFullYear();  
      const m = String(d.getMonth()+1).padStart(2,"0");  
      const day = String(d.getDate()).padStart(2,"0");  
      return `${y}-${m}-${day}`;  
    }  

    function bmrMifflin({sex, age, heightFt, heightIn, weight}){  
      const hIn = (Number(heightFt)||0)*12 + (Number(heightIn)||0);  
      const cm = inchesToCm(hIn);  
      const kg = lbsToKg(Number(weight)||0);  
      // Mifflin-St Jeor:  
      // men: 10*kg + 6.25*cm - 5*age + 5  
      // women: 10*kg + 6.25*cm - 5*age - 161  
      const base = 10*kg + 6.25*cm - 5*(Number(age)||0);  
      return sex==="female" ? (base - 161) : (base + 5);  
    }  

    function maintenanceCalories(profile){  
      const bmr = bmrMifflin(profile);  
      const act = Number(profile.activity)||1.2;  
      return bmr * act;  
    }  

    function targetCalories(profile){  
      const maintain = maintenanceCalories(profile);  
      const lossLbs = Number(profile.goalLoss)||0;  
      const weeks = Math.max(1, Number(profile.weeks)||1);  
      const totalDeficit = lossLbs * 3500;  
      const dailyDeficit = totalDeficit / (weeks*7);  
      return maintain - dailyDeficit;  
    }  

    // simple walking burn estimate: ~0.04 kcal per lb per minute at moderate pace  
    function walkBurnCalories(weightLb, minutes){  
      const w = Number(weightLb)||0;  
      const min = Number(minutes)||0;  
      return w * 0.04 * min;  
    }  

    function estimateWalkMinutesNeeded(profile){  
      const maintain = maintenanceCalories(profile);  
      const target = targetCalories(profile);  
      const neededDeficit = Math.max(0, maintain - target);  
      // assume half deficit from walking? No — here: estimate minutes needed if ALL deficit was walking.  
      const perMin = (Number(profile.weight)||0) * 0.04;  
      if(perMin <= 0.1) return 0;  
      return neededDeficit / perMin;  
    }  

    function estimateSteps(minutes){  
      // assume 3 mph = 20 min/mile; 2000 steps/mile  
      const miles = minutes / 20;  
      return miles * 2000;  
    }  

    function ozToGrams(oz){ return (Number(oz)||0) * 28.349523125; }  
    function macroCaloriesFromOunces(pOz,cOz,fOz){  
      const pG = ozToGrams(pOz);  
      const cG = ozToGrams(cOz);  
      const fG = ozToGrams(fOz);  
      return (pG*4) + (cG*4) + (fG*9);  
    }  

    function load(){  
      try{  
        const raw = localStorage.getItem(STORAGE_KEY);  
        if(!raw) return;  
        const data = JSON.parse(raw);  
        if(data && typeof data==="object"){  
          if(data.profile) Object.assign(state.profile, data.profile);  
          if(data.today) Object.assign(state.today, data.today);  
          if(Array.isArray(data.history)) state.history = data.history;  
        }  
      }catch(e){}  
    }  

    function save(){  
      localStorage.setItem(STORAGE_KEY, JSON.stringify(state));  
      toast("Saved");  
    }  

    function resetAll(){  
      localStorage.removeItem(STORAGE_KEY);  
      location.reload();  
    }  

    function bind(){  
      // profile inputs  
      $("age").value = state.profile.age;  
      $("heightFt").value = state.profile.heightFt;  
      $("heightIn").value = state.profile.heightIn;  
      $("weight").value = state.profile.weight;  
      $("goalLoss").value = state.profile.goalLoss;  
      $("weeks").value = state.profile.weeks;  
      $("activity").value = String(state.profile.activity);  
      $("sex").value = state.profile.sex;  

      // today inputs  
      state.today.date = getTodayISO();  
      $("todayWalkMin").value = state.today.walkMin;  
      $("todayCals").value = state.today.eaten;  
      $("pOz").value = state.today.pOz;  
      $("cOz").value = state.today.cOz;  
      $("fOz").value = state.today.fOz;  
      $("fibOz").value = state.today.fibOz;  

      const onProfileChange = ()=>{  
        state.profile.age = clampNum(parseFloat($("age").value), 1, 120);  
        state.profile.heightFt = clampNum(parseFloat($("heightFt").value), 1, 8);  
        state.profile.heightIn = clampNum(parseFloat($("heightIn").value), 0, 11);  
        state.profile.weight = clampNum(parseFloat($("weight").value), 50, 800);  
        state.profile.goalLoss = clampNum(parseFloat($("goalLoss").value), 0, 300);  
        state.profile.weeks = clampNum(parseFloat($("weeks").value), 1, 260);  
        state.profile.activity = parseFloat($("activity").value);  
        state.profile.sex = $("sex").value;  
        render();  
      };  

      ["age","heightFt","heightIn","weight","goalLoss","weeks","activity","sex"].forEach(id=>{  
        $(id).addEventListener("input", onProfileChange);  
        $(id).addEventListener("change", onProfileChange);  
      });  

      const onTodayChange = ()=>{  
        state.today.date = getTodayISO();  
        state.today.walkMin = clampNum(parseFloat($("todayWalkMin").value), 0, 2000);  
        state.today.eaten = clampNum(parseFloat($("todayCals").value), 0, 20000);  
        state.today.pOz = clampNum(parseFloat($("pOz").value), 0, 500);  
        state.today.cOz = clampNum(parseFloat($("cOz").value), 0, 500);  
        state.today.fOz = clampNum(parseFloat($("fOz").value), 0, 500);  
        state.today.fibOz = clampNum(parseFloat($("fibOz").value), 0, 500);  
        render();  
      };  

      ["todayWalkMin","todayCals","pOz","cOz","fOz","fibOz"].forEach(id=>{  
        $(id).addEventListener("input", onTodayChange);  
        $(id).addEventListener("change", onTodayChange);  
      });  

      $("btnSave").addEventListener("click", save);  
      $("btnReset").addEventListener("click", ()=>{  
        if(confirm("Reset everything on this device?")) resetAll();  
      });  
      $("btnAddToday").addEventListener("click", logToday);  
      $("btnExport").addEventListener("click", exportCSV);  
    }  

    function render(){  
      const todayISO = getTodayISO();  
      $("todayPill").textContent = `Today: ${todayISO}`;  

      const maintain = maintenanceCalories(state.profile);  
      const target = targetCalories(state.profile);  
      const walkMin = estimateWalkMinutesNeeded(state.profile);  
      const steps = estimateSteps(walkMin);  

      $("kpiMaintain").textContent = Math.round(maintain).toLocaleString();  
      $("kpiTargetCals").textContent = Math.round(target).toLocaleString();  
      $("kpiWalkMin").textContent = `${Math.max(0, Math.round(walkMin))}`;  
      $("kpiSteps").textContent = `${Math.max(0, Math.round(steps)).toLocaleString()}`;  

      const totalDeficit = (Number(state.profile.goalLoss)||0) * 3500;  
      const plannedDays = Math.max(1, (Number(state.profile.weeks)||1)*7);  
      const dailyDeficit = totalDeficit / plannedDays;  

      const pct = clampNum((dailyDeficit / 1000) * 100, 0, 100);  
      $("progressBar").style.width = `${pct}%`;  
      $("progressText").textContent = `Planned daily deficit ≈ ${Math.round(dailyDeficit).toLocaleString()} kcal/day (from maintenance).`;  

      // Today metrics  
      const walkBurn = walkBurnCalories(state.profile.weight, state.today.walkMin);  
      const deficit = (maintain + walkBurn) - state.today.eaten;  
      const macroCals = macroCaloriesFromOunces(state.today.pOz, state.today.cOz, state.today.fOz);  

      $("kpiMacroCals").textContent = Math.round(macroCals).toLocaleString();  
      $("kpiDeficit").textContent = `${Math.round(deficit).toLocaleString()}`;  
      $("kpiDeficit").className = "value " + (deficit>=0 ? "good":"bad");  

      // Log pill  
      const logged = state.history.some(e=>e.date===todayISO);  
      $("logPill").textContent = logged ? "Logged" : "Not logged";  
      $("logPill").className = "pill " + (logged ? "good":"muted");  

      // Chips / quick feedback  
      const chips = [];  
      chips.push({t:`Walk burn est: ${Math.round(walkBurn)} kcal`, c:"chip"});  
      chips.push({t:`Maintenance: ${Math.round(maintain)} kcal`, c:"chip"});  
      chips.push({t:`Target: ${Math.round(target)} kcal`, c:"chip"});  
      const diff = state.today.eaten - target;  
      chips.push({t:`Eaten vs target: ${Math.round(diff)} kcal`, c:"chip"});  

      const el = $("chips");  
      el.innerHTML = "";  
      chips.forEach(x=>{  
        const d = document.createElement("div");  
        d.className = x.c;  
        d.textContent = x.t;  
        el.appendChild(d);  
      });  

      // History table  
      const tb = $("historyTable").querySelector("tbody");  
      tb.innerHTML = "";  
      const sorted = [...state.history].sort((a,b)=>a.date<b.date?1:-1);  
      sorted.forEach(e=>{  
        const tr = document.createElement("tr");  
        tr.innerHTML = `  
          <td>${e.date}</td>  
          <td class="right">${(e.walkMin??0)}</td>  
          <td class="right">${(e.eaten??0)}</td>  
          <td class="right">${Math.round(e.deficit??0)}</td>  
          <td class="right">${(e.pOz??0)}</td>  
          <td class="right">${(e.cOz??0)}</td>  
          <td class="right">${(e.fOz??0)}</td>  
        `;  
        tb.appendChild(tr);  
      });  
      $("historyPill").textContent = `${state.history.length} days`;  
    }  

    function logToday(){  
      const maintain = maintenanceCalories(state.profile);  
      const walkBurn = walkBurnCalories(state.profile.weight, state.today.walkMin);  
      const deficit = (maintain + walkBurn) - state.today.eaten;  
      const date = getTodayISO();  

      // upsert entry for today  
      const idx = state.history.findIndex(e=>e.date===date);  
      const entry = {  
        date,  
        walkMin: Math.round(state.today.walkMin),  
        eaten: Math.round(state.today.eaten),  
        deficit: deficit,  
        pOz: Number(state.today.pOz)||0,  
        cOz: Number(state.today.cOz)||0,  
        fOz: Number(state.today.fOz)||0  
      };  
      if(idx>=0) state.history[idx]=entry; else state.history.push(entry);  
      save();  
      render();  
      toast("Logged today");  
    }  

    function exportCSV(){  
      const rows = [  
        ["date","walk_min","eaten_kcal","deficit_est","protein_oz","carbs_oz","fat_oz"]  
      ];  
      const sorted = [...state.history].sort((a,b)=>a.date<b.date?-1:1);  
      sorted.forEach(e=>{  
        rows.push([e.date, e.walkMin, e.eaten, Math.round(e.deficit||0), e.pOz||0, e.cOz||0, e.fOz||0]);  
      });  
      const csv = rows.map(r=>r.map(x=>`"${String(x).replaceAll('"','""')}"`).join(",")).join("\n");  
      const blob = new Blob([csv], {type:"text/csv;charset=utf-8"});  
      const url = URL.createObjectURL(blob);  
      const a = document.createElement("a");  
      a.href = url;  
      a.download = `walkcut_history_${getTodayISO()}.csv`;  
      document.body.appendChild(a);  
      a.click();  
      a.remove();  
      URL.revokeObjectURL(url);  
      toast("Exported CSV");  
    }  

    // init  
    load();  
    bind();  
    render();  
  </script>  
</body>  
</html>
